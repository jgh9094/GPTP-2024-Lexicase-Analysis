# Exploitation rate results

Here we report the **performance** and evaluation a **satisfactory solution** was found on the exploitation rate diagnostic.
50 replicates were conducted for each population size explored.
Performance is defined at the average trait performance, where we collect the best performing solution in each generation over time and the best performing solution evolved. 
A satisfactory solution is defined as a solution that has a phenotype with all traits greater than or equal to 99.0.

## Analysis setup

```{r exp-data-setup, message=FALSE}
library(ggplot2)
library(cowplot)
library(dplyr)
library(PupillometryR)

# over time data 
over_time <- read.csv("../Paper_Data/Exploitation/ot.csv", header = TRUE, stringsAsFactors = FALSE)
over_time$pop_size <- factor(over_time$pop_size, levels = NAMES)

# best performance data
best <- read.csv('../Paper_Data/Exploitation/best.csv', header = TRUE, stringsAsFactors = FALSE)
best$pop_size <- factor(best$pop_size, levels = NAMES)

# get the data
ssf <- read.csv('../Paper_Data/Exploitation/ssf.csv', header = TRUE, stringsAsFactors = FALSE)
ssf$pop_size <- factor(ssf$pop_size, levels = NAMES)
ssf <- filter(ssf, evaluation <= 1.5*10^9)
```

## Performance over time

Performance of the best solution in the population at each generation over time.

```{r exp-perf-ot, message=FALSE, out.width="100%"}
# aggregate 
lines = over_time %>%
  group_by(pop_size, eval) %>%
  dplyr::summarise(
    min = min(performance),
    mean = mean(performance),
    max = max(performance)
  )
lines$pop_size <- factor(lines$pop_size, levels = NAMES)

ggplot(lines, aes(x=eval, y=mean, group = pop_size, fill = pop_size, color = pop_size, shape = pop_size)) +
  geom_ribbon(aes(ymin = min, ymax = max), alpha = 0.1) +
  geom_line(linewidth = 0.5) +
  geom_point(data = filter(lines, eval %% 100000000 == 0 & eval != 0), size = 1.0, stroke = 2.0, alpha = 1.0) +
  scale_y_continuous(
    name="Average trait score",
    limits=c(0, 100),
    breaks=seq(0,100, 25),
    labels=c("0", "25", "50", "75", "100")
  ) +
  scale_x_continuous(
    name="Evaluation",
    labels = c('0.0e+0', '5.0e+8','1.0e+9','1.5e+9'),
    limits = c(0,1520000000)
    
  ) +
  scale_shape_manual(values=SHAPE)+
  scale_colour_manual(values = cb_palette) +
  scale_fill_manual(values = cb_palette) +
  ggtitle('Performance over time')+
  p_theme +
  guides(
    shape=guide_legend(nrow=2, title.position = "left", title = 'Population\nSize'),
    color=guide_legend(nrow=2, title.position = "left", title = 'Population\nSize'),
    fill=guide_legend(nrow=2, title.position = "left", title = 'Population\nSize')
  )
```

## Best performance evolved

Performance of the best solution found throughout the entire evolutionary run.

```{r exp-perf-best, message=FALSE, out.width="100%"}
ggplot(best, aes(x = pop_size, y = performance, color = pop_size, fill = pop_size, shape = pop_size)) +
  geom_flat_violin(position = position_nudge(x = .1, y = 0), scale = 'width', alpha = 0.2, width = 1.5) +
  geom_boxplot(color = 'black', width = .07, outlier.shape = NA, alpha = 0.0, size = 1.0, position = position_nudge(x = .16, y = 0)) +
  geom_point(position = position_jitter(width = 0.02, height = 0.0001), size = 1.5, alpha = 1.0) +
  scale_y_continuous(
    name="Average trait score",
    limits=c(0, 100),
    breaks=seq(0,100, 25),
    labels=c("0", "25", "50", "75", "100")
  ) +
  scale_x_discrete(
    name="Population Size"
  )+
  scale_shape_manual(values=SHAPE)+
  scale_colour_manual(values = cb_palette, ) +
  scale_fill_manual(values = cb_palette) +
  ggtitle('Best performance throughout')+
  p_theme+ coord_flip() +
  guides(
    shape=guide_legend(nrow=2, title.position = "left", title = 'Population\nSize'),
    color=guide_legend(nrow=2, title.position = "left", title = 'Population\nSize'),
    fill=guide_legend(nrow=2, title.position = "left", title = 'Population\nSize')
  )
```

### Summary statistics

```{r exp-perf-best-sts, message=FALSE, out.width="100%"}
best %>%
  group_by(pop_size) %>%
  dplyr::summarise(
    count = n(),
    na_cnt = sum(is.na(performance)),
    min = min(performance, na.rm = TRUE),
    median = median(performance, na.rm = TRUE),
    mean = mean(performance, na.rm = TRUE),
    max = max(performance, na.rm = TRUE),
    IQR = IQR(performance, na.rm = TRUE)
  )
```

### Kruskal-Wallis test

```{r exp-perf-best-kru, message=FALSE, out.width="100%"}
kruskal.test(performance ~ pop_size, data = best)
```


### Pairwise wilcoxon test

```{r exp-perf-best-wil, message=FALSE, out.width="100%"}
pairwise.wilcox.test(x = best$performance, g = best$pop_size, p.adjust.method = "bonferroni",
                     paired = FALSE, conf.int = FALSE, alternative = 'l')
```

## Evaluation satisfactory solution if found

Evaluation a satisfactory solution is found for each population size.

```{r exp-ssf, message=FALSE, out.width="100%"}
ggplot(ssf, aes(x = pop_size, y = evaluation, color = pop_size, fill = pop_size, shape = pop_size)) +
  geom_flat_violin(position = position_nudge(x = 0.12, y = 0), scale = 'width', alpha = 0.2, width = 1.5) +
  geom_boxplot(color = 'black', width = .08, outlier.shape = NA, alpha = 0.0, size = 0.8, position = position_nudge(x = .19, y = 0)) +
  geom_point(position = position_jitter(width = 0.03, height = 0.000001), size = 1.5, alpha = 1.0) +
  scale_y_continuous(
    name = 'Evaluation',
    breaks = c(100000000,500000000,1000000000,1500000000),
    labels = c('1.0e+8', '5.0e+8','1.0e+9','1.5e+9'),
    limits = c(100000000,1500000000)
    ) +
  scale_x_discrete(
    name="Population Size",
  )+
  scale_shape_manual(values=SHAPE, )+
  scale_colour_manual(values = cb_palette, ) +
  scale_fill_manual(values = cb_palette) +
  ggtitle(bquote('Evaluation Satisfactory Solution Found'))+
  p_theme + coord_flip() +
  guides(
    shape=guide_legend(nrow=2, title.position = "left", title = 'Population\nSize'),
    color=guide_legend(nrow=2, title.position = "left", title = 'Population\nSize'),
    fill=guide_legend(nrow=2, title.position = "left", title = 'Population\nSize')
  )
```

### Summary statistics

```{r exp-ssf-sts, message=FALSE, out.width="100%"}
ssf %>%
  group_by(pop_size) %>%
  dplyr::summarise(
    count = n(),
    na_cnt = sum(is.na(evaluation)),
    min = min(evaluation, na.rm = TRUE),
    median = median(evaluation, na.rm = TRUE),
    mean = mean(evaluation, na.rm = TRUE),
    max = max(evaluation, na.rm = TRUE),
    IQR = IQR(evaluation, na.rm = TRUE)
  )
```

### Kruskal-Wallis test

```{r exp-ssf-kru, message=FALSE, out.width="100%"}
kruskal.test(evaluation ~ pop_size, data = ssf)
```


### Pairwise wilcoxon test

```{r exp-ssf-wil, message=FALSE, out.width="100%"}
pairwise.wilcox.test(x = ssf$evaluation, g = ssf$pop_size, p.adjust.method = "bonferroni",
                     paired = FALSE, conf.int = FALSE, alternative = 'g')
```








